import warnings
import sys
# Append the module path to the sys.path list
sys.path.append('/home/sotiria/workspace/Luminosity_Function/src/no_uncertainties_included/MLE/MLE_modules/')
import time
import math   
from numpy import array,log,sqrt,power,linspace,vectorize,ones,tile,sum, log10, savetxt, genfromtxt, asarray
import numpy as np
from Source import Source
from parameters import Parameters
from LFunctions import Models
from scipy.integrate import simps
import minuit
import matplotlib.pyplot as plt
import matplotlib.mlab as mlt

params = Parameters()
Lmin, Lmax = Parameters.L(params)
zmin, zmax = Parameters.z(params)

model = Models()
########################################################
# Data
#work =  ["Ueda", "LaFranca","Silverman", "Ebrero",         "Ebrero",       "Aird",     "Fotopoulou"]
#L0 =     [43.94,    44.25,   44.33,         43.91,           44.40,         44.24,      44.63]
#g1 =     [0.86,     1.01,    1.10,          0.96,            0.872,         0.80,       1.40]
#g2 =     [2.23,     2.38,    2.15,          2.35,            2.36,          2.36,       3.4]
#p1 =     [4.23,     4.62,    4.22,          4.07,            3.61,          4.48,       4.89]
#p2 =     [-1.5,     -1.15,   -3.27,         -1.5,           -2.83,          -2.85,      -3.8]
#zc =     [1.9,      2.49,    1.89,          1.9,             2.18,          1.89,       2.03]
#La =     [44.6,     45.74,   44.6,          44.6,            45.09,         45.24,      43.85]
#a =      [0.335,    0.2,     0.333,         0.245,          0.208,          0.15,       0.55]
#Normal = [log10(5.04e-6),  log10(1.21e-6), -6.163, log10(4.78e-6), -6.140, -5.91, -7.45]
#
#e_L0 =  [0.26,      0.18,    0.10,          0.01,            0.14,           0.11,      0.13]
#e_g1 =  [0.15,      0.10,    0.42,          0.02,            0.060,          0.03,       0.07]
#e_g2 =  [0.13,      0.13,    0.13,          0.07,            0.24,           0.15,       0.4]
#e_p1 =  [0.39,      0.26,    0.27,          0.07,            0.49,           0.30,       0.28]
#e_p2 =  [0.0001,    0.72,    0.34,          0.0001,          0.24,           0.24,      0.6]
#e_zc =  [0.0001,    0.82,    0.14,          0.0001,          0.55,           0.14,       0.14]
#e_La =  [0.0001,    0.63,    0.0001,        0.0001,          0.49,           0.19,      0.06]
#e_a =   [0.070,     0.04,    0.013,         0.003,           0.019,          0.01,       0.06]
#e_Normal = [0.434294482*0.33e-6/5.04e-6, 0.434294482*0.0605e-6/1.21e-6, 0.015, 0.434294482*0.23e-6/4.78e-6, 0.038,0.19, 0.18]

Ueda_params = [43.94, 0.86, 2.23, 4.23, -1.5, 1.9, 44.6, 0.335, -5.2975]
Ueda_e_params = [0.26, 0.15, 0.13, 0.39, 0, 0, 0, 0.070, 0.028]

LaFranca_params = [44.25, 1.01, 2.38, 4.62, -1.15, 2.49, 45.74, 0.2, -5.917]
LaFranca_e_params = [0.18, 0.10, 0.13, 0.26, 0.72, 0.82, 0.63, 0.04, 0.022]

Silverman_params = [44.33, 1.10, 2.15, 4.22, -3.27, 1.89, 44.6, 0.333, -6.163]
Silverman_e_params = [0.10, 0.42, 0.13, 0.27, 0.34, 0.14, 0, 0.013, 0.015]

Ebrero_params = [43.91, 0.96, 2.35, 4.07, -1.5, 1.9, 44.6, 0.245, -5.32057]
Ebrero_e_params = [0.01, 0.02, 0.07, 0.07, 0, 0, 0, 0.003, 0.021]

Ebrero_params = [44.40, 0.872, 2.36, 3.61, -2.83, 2.18, 45.09, 0.208, -6.140]
Ebrero_e_params = [0.14, 0.060, 0.24, 0.49, 0.24, 0.55, 0.49, 0.019, 0.038]

Aird_params = [44.24, 0.80, 2.36, 4.48, -2.85, 1.89, 45.24, 0.15, -5.91]
Aird_e_params = [0.11, 0.03, 0.15, 0.30, 0.24, 0.14, 0.19, 0.01, 0.19]

F_params = [44.63, 1.40, 3.4, 4.89, -3.8, 2.03, 43.85, 0.55, -7.45]
F_e_params = [0.13, 0.07, 0.4, 0.28, 0.6, 0.14, 0.06, 0.06, 0.29]

FU_params = []
FU_e_params = [0.019206512459420341,0.093970744976324155,0.034074814126592863,0.13079504776251571,0.57603184668120944,0.84571534600091136,0.032347119452283336,0.034038080536130548,0.030269452424421982]
# Using LDDE Fotopoulou formula, more significant digits!
#
#covariance_matrix = [[0.0172,    0.0073,    0.0462,    0.0088,    0.0080,    -0.0051,    -0.0038,    0.0031,    -0.0363],
#                     [0.0073,    0.0054,    0.0176,    0.0109,    0.0111,    -0.0036,    -0.0014,    0.0024,    -0.0187],
#                     [0.0462,    0.0176,    0.2002,    0.0125,    0.0129,    -0.0107,    -0.0101,    0.0073,    -0.0944],
#                     [0.0088,    0.0109,    0.0125,    0.0776,    0.0731,    -0.0296,    -0.0010,    0.0015,    -0.0385],
#                     [0.0080,    0.0111,    0.0129,    0.0731,    0.3668,    -0.0516,    -0.0031,    0.0141,    -0.0301],
#                     [-0.0051,  -0.0036,   -0.0107,   -0.0296,   -0.0516,     0.0194,     0.0027,   -0.0014,     0.0155],
#                     [-0.0038,  -0.0014,   -0.0101,   -0.0010,   -0.0031,     0.0027,     0.0034,   -0.0020,     0.0075],
#                     [0.0031,    0.0024,    0.0073,    0.0015,    0.0141,    -0.0014,    -0.0020,    0.0033,    -0.0071],
#                     [-0.0363,  -0.0187,   -0.0944,   -0.0385,   -0.0301,     0.0155,     0.0075,   -0.0071,     0.0841]]
# Ueda formula
covariance_matrix = [[0.000368890120853869,   0.000311914681762477, -0.000056535740231731,   -0.000234058446484418,    0.002267005705780310,   -0.003932722603867620,    0.000010198685159686,    -0.000158581779338478,    -0.000219952215799852],
                     [0.000311914681762477,   0.008830500911405350,  0.000313806483317604,   -0.002346445949394620,   -0.018288904037273200,    0.030369471363113300,    -0.000063341625792713,    0.001229504407231710,    -0.000295699322097454],
                     [-0.000056535740231731,  0.000313806483317604,  0.001161092957761850,   -0.001567482141600320,   -0.009936292011778130,    0.015108095847769800,    -0.000028441027742889,    0.000615095761475291,    -0.000369222518750651],
                     [-0.000234058446484418, -0.002346445949394620, -0.001567482141600320,    0.017107344519198800,    0.040851757603061000,   -0.079498507774807000,    0.000225037414577411,    -0.003178395813839990,    -0.000860987682452792],
                     [0.002267005705780310,  -0.018288904037273200, -0.009936292011778130,    0.040851757603061000,    0.331812688390964000,   -0.397012990091855000,    0.001393954363430340,    -0.015739051756333500,    0.000395013709747738],
                     [-0.003932722603867620,  0.030369471363113300,  0.015108095847769800,   -0.079498507774807000,   -0.397012990091855000,    0.715234446461441000,    0.000999352767523333,    0.028533369815610000,    -0.001197829148963430],
                     [0.000010198685159686,  -0.000063341625792713, -0.000028441027742889,    0.000225037414577411,    0.001393954363430340,    0.000999352767523333,    0.001046336136860290,    -0.000056385386364726,    0.000005702812949768],
                     [-0.000158581779338478,  0.001229504407231710,  0.000615095761475291,   -0.003178395813839990,   -0.015739051756333500,    0.028533369815610000,    -0.000056385386364726,    0.001158590926584110,    -0.000046676039255985],
                     [-0.000219952215799852, -0.000295699322097454, -0.000369222518750651,   -0.000860987682452792,    0.000395013709747738,   -0.001197829148963430,    0.000005702812949768,    -0.000046676039255985,    0.000916239750074346]]

from numpy.linalg import *
sigma = 1.0/array( FU_e_params )
stds = np.outer(sigma, sigma)
scaled = stds*covariance_matrix
print scaled
print
Ebrero_sigma = array(Ebrero_e_params)
stds = np.outer(Ebrero_sigma, Ebrero_sigma)
Ebrero_matrix = stds*scaled
print Ebrero_matrix
label = 'Ebrero'
values = np.random.multivariate_normal(Ebrero_params, Ebrero_matrix, 10000)
#plt.plot(values[:,0],values[:,1],'.')
#plt.show()
name = '/home/sotiria/workspace/Luminosity_Function/src/LF_Plots/covariance/'+label+'.prob'
savetxt(name, values)
